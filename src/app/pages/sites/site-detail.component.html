
<div class="min-h-screen bg-gray-50">
  <!-- Sticky Header -->
  <div class="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-4">
        <div class="flex items-center space-x-4">
          <a
            routerLink="/sites"
            hlmBtn
            variant="outline"
            size="sm"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            {{ 'siteDetail.back' | transloco }}
          </a>
          @if (site()) {
            <div>
              <h1 class="text-2xl font-bold text-gray-900">{{ site()!.name }}</h1>
              @if (site()!.status) {
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [ngClass]="{
                    'bg-blue-100 text-blue-800': site()!.status === 'planning',
                    'bg-green-100 text-green-800': site()!.status === 'active',
                    'bg-yellow-100 text-yellow-800': site()!.status === 'on_hold',
                    'bg-gray-100 text-gray-800': site()!.status === 'completed'
                  }"
                >
                  {{ formatStatus(site()!.status) }}
                </span>
              }
            </div>
          }
        </div>

        @if (!loading() && site()) {
          <div class="flex items-center space-x-2">
            @if (canEditGeneral() && !isEditMode()) {
              <button hlmBtn variant="default" size="sm" (click)="enterEditMode()">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                {{ 'siteDetail.editSite' | transloco }}
              </button>
            }
            @if (canEditGeneral() && isEditMode()) {
              <button hlmBtn variant="default" size="sm" (click)="saveSiteChanges()">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                {{ 'siteDetail.saveChanges' | transloco }}
              </button>
              <button hlmBtn variant="outline" size="sm" (click)="cancelEditMode()">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                {{ 'common.cancel' | transloco }}
              </button>
            }
            @if (!canEditGeneral()) {
              <div class="text-right">
                <button hlmBtn variant="outline" size="sm" [disabled]="true">
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  {{ 'siteDetail.readOnly' | transloco }}
                </button>
                <p class="text-xs text-gray-500 mt-1">{{ 'siteDetail.readOnlyMessage' | transloco }}</p>
              </div>
            }
          </div>
        }
      </div>

      <!-- Tabs Navigation -->
      @if (!loading() && site()) {
        <nav class="flex space-x-8 -mb-px" aria-label="Tabs">
          <button
            (click)="setActiveTab('overview')"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors"
            [ngClass]="{
              'border-blue-600 text-blue-600': activeTab() === 'overview',
              'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab() !== 'overview'
            }"
          >
            {{ 'siteDetail.overview' | transloco }}
          </button>
          <button
            (click)="setActiveTab('workers')"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors"
            [ngClass]="{
              'border-blue-600 text-blue-600': activeTab() === 'workers',
              'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab() !== 'workers'
            }"
          >
            {{ 'siteDetail.workers' | transloco }}
          </button>
          <button
            (click)="setActiveTab('materials')"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors"
            [ngClass]="{
              'border-blue-600 text-blue-600': activeTab() === 'materials',
              'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab() !== 'materials'
            }"
          >
            {{ 'siteDetail.materials' | transloco }}
          </button>
          <button
            (click)="setActiveTab('assignments')"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors"
            [ngClass]="{
              'border-blue-600 text-blue-600': activeTab() === 'assignments',
              'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab() !== 'assignments'
            }"
          >
            {{ 'siteDetail.assignments' | transloco }}
          </button>
          <button
            (click)="setActiveTab('dailyLog')"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors"
            [ngClass]="{
              'border-blue-600 text-blue-600': activeTab() === 'dailyLog',
              'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab() !== 'dailyLog'
            }"
          >
            {{ 'siteDetail.dailyLog' | transloco }}
            @if (canEditDailyLogTab() && !canEditGeneral()) {
              <svg class="w-4 h-4 ml-1 inline-block text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            }
          </button>
        </nav>
      }
    </div>
  </div>

  <!-- Content Area -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    @if (loading()) {
      <div class="flex items-center justify-center py-12">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
          <p class="mt-2 text-sm text-gray-600">Loading site details...</p>
        </div>
      </div>
    } @else if (error()) {
      <div class="rounded-lg bg-red-50 p-4">
        <p class="text-sm text-red-800">{{ error() }}</p>
      </div>
    } @else if (site()) {
      <!-- Overview Tab -->
      @if (activeTab() === 'overview') {
        <app-site-overview-tab
                  [canEdit]="canEditGeneral()"
                  [isEditMode]="isEditMode()"
                  [site]="site()"
                  [siteForm]="siteForm()"
                  [siteEditError]="siteEditError()"
                  [siteClient]="siteClient()"
                  [projectManager]="projectManager()"
                  [clients]="clients()"
                  [formatStatus]="formatStatus.bind(this)"
                  (enterEditModeRequested)="enterEditMode()"
                  (saveRequested)="onOverviewSave($event)"
                  (cancelEditRequested)="cancelEditMode()"
                >
        <div class="space-y-4">
          <!-- Site Information Card -->
          <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
              <h3 class="text-base font-semibold text-gray-900">Site Information</h3>
              @if (canEditGeneral() && !isEditMode()) {
                <button hlmBtn variant="ghost" size="sm" (click)="enterEditMode()">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Edit
                </button>
              }
            </div>
            <div class="px-4 py-4">
              @if (!isEditMode()) {
                <div class="space-y-3">
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Site Name</span>
                    </div>
                    <div class="flex-1">
                      <span class="text-sm text-gray-900">{{ site()!.name }}</span>
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Status</span>
                    </div>
                    <div class="flex-1">
                      @if (site()!.status) {
                        <span
                          class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"
                          [ngClass]="{
                            'bg-blue-100 text-blue-800': site()!.status === 'planning',
                            'bg-green-100 text-green-800': site()!.status === 'active',
                            'bg-yellow-100 text-yellow-800': site()!.status === 'on_hold',
                            'bg-gray-100 text-gray-800': site()!.status === 'completed'
                          }"
                        >
                          {{ formatStatus(site()!.status) }}
                        </span>
                      } @else {
                        <span class="text-sm text-gray-400">Not set</span>
                      }
                    </div>
                  </div>
                </div>
              } @else {
                <!-- Edit Mode Form -->
                <div class="space-y-4">
                  @if (siteEditError()) {
                    <div class="rounded-md bg-red-50 p-3">
                      <p class="text-sm text-red-800">{{ siteEditError() }}</p>
                    </div>
                  }
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Site Name <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [value]="siteForm().name"
                      (input)="updateSiteName($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Enter site name"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Status <span class="text-red-500">*</span>
                    </label>
                    <select
                      [value]="siteForm().status"
                      (change)="updateSiteStatus($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="planning">Planning</option>
                      <option value="active">Active</option>
                      <option value="on_hold">On Hold</option>
                      <option value="completed">Completed</option>
                    </select>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Location Card -->
          <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
              <h3 class="text-base font-semibold text-gray-900">Location</h3>
              @if (canEditGeneral() && !isEditMode()) {
                <button hlmBtn variant="ghost" size="sm" (click)="enterEditMode()">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Edit
                </button>
              }
            </div>
            <div class="px-4 py-4">
              @if (!isEditMode()) {
                <div class="space-y-3">
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Address</span>
                    </div>
                    <div class="flex-1">
                      <span class="text-sm text-gray-900">{{ site()!.address }}</span>
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">City</span>
                    </div>
                    <div class="flex-1">
                      @if (site()!.city) {
                        <span class="text-sm text-gray-900">{{ site()!.city }}</span>
                      } @else {
                        <span class="text-sm text-gray-400">Not set</span>
                      }
                    </div>
                  </div>
                </div>
              } @else {
                <!-- Edit Mode Form -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Address <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [value]="siteForm().address"
                      (input)="updateSiteAddress($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Enter address"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      City
                    </label>
                    <input
                      type="text"
                      [value]="siteForm().city"
                      (input)="updateSiteCity($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Enter city"
                    />
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Client & Project Manager Card -->
          <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
              <h3 class="text-base font-semibold text-gray-900">Client & Management</h3>
              @if (canEditGeneral() && !isEditMode()) {
                <button hlmBtn variant="ghost" size="sm" (click)="enterEditMode()">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Edit
                </button>
              }
            </div>
            <div class="px-4 py-4">
              @if (!isEditMode()) {
                <div class="space-y-3">
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Client</span>
                    </div>
                    <div class="flex-1">
                      @if (siteClient()) {
                        <div>
                          <div class="text-sm text-gray-900">{{ siteClient()!.name }}</div>
                          @if (siteClient()!.company) {
                            <div class="text-xs text-gray-500 mt-0.5">{{ siteClient()!.company }}</div>
                          }
                        </div>
                      } @else {
                        <span class="text-sm text-gray-400">Not assigned</span>
                      }
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Project Manager</span>
                    </div>
                    <div class="flex-1">
                      @if (projectManager()) {
                        <div>
                          <div class="text-sm text-gray-900">{{ projectManager()!.name }}</div>
                          @if (projectManager()!.email) {
                            <div class="text-xs text-gray-500 mt-0.5">{{ projectManager()!.email }}</div>
                          }
                        </div>
                      } @else {
                        <span class="text-sm text-gray-400">Not assigned</span>
                      }
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">Start Date</span>
                    </div>
                    <div class="flex-1">
                      @if (site()!.startDate) {
                        <span class="text-sm text-gray-900">{{ site()!.startDate }}</span>
                      } @else {
                        <span class="text-sm text-gray-400">Not set</span>
                      }
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-32 flex-shrink-0">
                      <span class="text-sm font-medium text-gray-500">End Date</span>
                    </div>
                    <div class="flex-1">
                      @if (site()!.endDate) {
                        <span class="text-sm text-gray-900">{{ site()!.endDate }}</span>
                      } @else {
                        <span class="text-sm text-gray-400">Not set</span>
                      }
                    </div>
                  </div>
                </div>
              } @else {
                <!-- Edit Mode Form -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Client
                    </label>
                    <select
                      [value]="siteForm().clientId"
                      (change)="updateSiteClient($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="">-- No client --</option>
                      @for (client of clients(); track client.id) {
                        <option [value]="client.id">{{ client.name }}@if (client.company) { ({{ client.company }}) }</option>
                      }
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Start Date
                    </label>
                    <input
                      type="date"
                      [value]="siteForm().startDate"
                      (input)="updateSiteStartDate($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      End Date
                    </label>
                    <input
                      type="date"
                      [value]="siteForm().endDate"
                      (input)="updateSiteEndDate($any($event.target).value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <p class="text-xs text-gray-500 italic">Note: Project Manager is assigned through the Assignments tab</p>
                </div>
              }
            </div>
          </div>
        </div>
        </app-site-overview-tab>
      }

      <!-- Workers Tab -->
      @if (activeTab() === 'workers') {
        <app-site-workers-tab
          [workers]="workers()"
          [isWorkerAssigned]="isWorkerAssigned.bind(this)"
        ></app-site-workers-tab>
      }

      <!-- Materials Tab -->
      @if (activeTab() === 'materials') {
        <app-site-materials-tab
          [canEdit]="canEditGeneral()"
          [siteMaterials]="siteMaterials()"
          [getMaterialById]="getMaterialById.bind(this)"
          (addMaterialRequested)="openAddMaterialDialog()"
          (removeMaterialRequested)="openRemoveMaterialDialog($event)"
        ></app-site-materials-tab>
      }

      <!-- Assignments Tab -->
      @if (activeTab() === 'assignments') {
        <app-site-assignments-tab
          [canEdit]="canEditGeneral()"
          [siteAssignments]="siteAssignments()"
          [getWorkerById]="getWorkerById.bind(this)"
          (addAssignmentRequested)="openAddAssignmentDialog()"
          (removeAssignmentRequested)="openRemoveAssignmentDialog($event)"
        ></app-site-assignments-tab>
      }

      <!-- Daily Log Tab -->
      @if (activeTab() === 'dailyLog') {
        <app-site-daily-log-tab
                [canEditGeneral]="canEditGeneral()"
                [canEditDailyLogTab]="canEditDailyLogTab()"
                [canEditDailyLogForSelectedDate]="canEditDailyLogForSelectedDate()"
                [selectedDate]="selectedDate()"
                [dailyLogSuccess]="dailyLogSuccess()"
                [dailyLogError]="dailyLogError()"
                [currentDailyLog]="currentDailyLog()"
                [currentDailyLogEntries]="currentDailyLogEntries()"
                [getWorkerById]="getWorkerById.bind(this)"
                (dateChange)="onDateChange($event)"
                (createTodaysLogRequested)="createTodaysLog()"
                (addEntryRequested)="openAddEntryDialog()"
                (editEntryRequested)="openEditEntryDialog($event)"
                (deleteEntryRequested)="openDeleteEntryDialog($event)"
                >
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
          <div class="px-6 py-5 border-b border-gray-200">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-900">Daily Log</h2>
              <div class="flex items-center space-x-3">
                <!-- Date picker -->
                <input
                  type="date"
                  [ngModel]="selectedDate()"
                  (ngModelChange)="onDateChange($event)"
                  class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
            </div>

            <!-- Toast messages -->
            @if (dailyLogSuccess()) {
              <div class="mb-4 rounded-md bg-green-50 p-4">
                <div class="flex">
                  <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <p class="ml-3 text-sm font-medium text-green-800">{{ dailyLogSuccess() }}</p>
                </div>
              </div>
            }

            @if (dailyLogError()) {
              <div class="mb-4 rounded-md bg-red-50 p-4">
                <div class="flex">
                  <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                  </svg>
                  <p class="ml-3 text-sm font-medium text-red-800">{{ dailyLogError() }}</p>
                </div>
              </div>
            }

            @if (!canEditDailyLogTab() && !canEditGeneral()) {
              <div class="mb-4 rounded-lg bg-yellow-50 p-4 border border-yellow-200">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-yellow-800">View-only: ask your Org Admin for access</p>
                    <p class="text-sm text-yellow-700 mt-1">
                      You can only edit daily logs if you are an Organization Admin or assigned as a site manager for this site.
                    </p>
                  </div>
                </div>
              </div>
            }
          </div>

          <div class="px-6 py-5">
            @if (!currentDailyLog()) {
              <!-- No log exists for this date -->
              <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No log for this date</h3>
                <p class="mt-1 text-sm text-gray-500">Create a daily log to start tracking work entries.</p>
                @if (canEditDailyLogForSelectedDate()) {
                  <div class="mt-6">
                    <button
                      hlmBtn
                      variant="default"
                      (click)="createTodaysLog()"
                    >
                      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                      </svg>
                      Create Today's Log
                    </button>
                  </div>
                } @else {
                  <p class="mt-4 text-sm text-yellow-700">You can create a daily log only for today's date.</p>
                }
              </div>
            } @else {
              <!-- Log exists - show entries table -->
              <div class="mb-4 flex items-center justify-between">
                <h3 class="text-lg font-medium text-gray-900">Work Entries</h3>
                @if (canEditDailyLogForSelectedDate()) {
                  <button
                    hlmBtn
                    variant="default"
                    size="sm"
                    (click)="openAddEntryDialog()"
                  >
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                    Add Entry
                  </button>
                }
              </div>

              @if (currentDailyLogEntries().length === 0) {
                <p class="text-sm text-gray-500 text-center py-8">No entries for this log yet</p>
              } @else {
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Worker</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Break (min)</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                        @if (canEditDailyLogForSelectedDate()) {
                          <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        }
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      @for (entry of currentDailyLogEntries(); track entry.id) {
                        <tr>
                          <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                            {{ getWorkerById(entry.workerId)?.name || 'Unknown' }}
                          </td>
                          <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">{{ entry.startTime }}</td>
                          <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">{{ entry.endTime }}</td>
                          <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">{{ entry.breakMinutes }}</td>
                          <td class="px-4 py-3 text-sm text-gray-500">{{ entry.notes || '-' }}</td>
                          @if (canEditDailyLogForSelectedDate()) {
                            <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium space-x-2">
                              <button
                                (click)="openEditEntryDialog(entry)"
                                class="text-blue-600 hover:text-blue-900"
                              >
                                Edit
                              </button>
                              <button
                                (click)="openDeleteEntryDialog(entry)"
                                class="text-red-600 hover:text-red-900"
                              >
                                Delete
                              </button>
                            </td>
                          }
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>

                <!-- Totals section -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                  <div class="flex justify-end">
                    <div class="bg-blue-50 px-6 py-3 rounded-lg">
                      <span class="text-sm font-medium text-gray-700">Total Man-Hours: </span>
                      <span class="text-lg font-bold text-blue-600">{{ totalManHours().toFixed(2) }}</span>
                    </div>
                  </div>
                </div>
              }
            }
          </div>
        </div>
        </app-site-daily-log-tab>
      }
    }
  </div>

  <!-- Add Assignment Dialog -->
  @if (showAddAssignmentDialog()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeAddAssignmentDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modal-title">
                  Add Assignment
                </h3>

                <!-- Success message -->
                @if (assignmentSuccess()) {
                  <div class="mb-4 rounded-md bg-green-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-green-800">{{ assignmentSuccess() }}</p>
                    </div>
                  </div>
                }

                <!-- Error message -->
                @if (assignmentError()) {
                  <div class="mb-4 rounded-md bg-red-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-red-800">{{ assignmentError() }}</p>
                    </div>
                  </div>
                }

                <!-- Form -->
                <div class="space-y-4">
                  <!-- Worker selection -->
                  <div>
                    <label for="worker" class="block text-sm font-medium text-gray-700 mb-1">Worker *</label>
                    <select
                      id="worker"
                      [ngModel]="newAssignment().workerId"
                      (ngModelChange)="updateWorker($event)"
                      class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                    >
                      <option value="">Select a worker</option>
                      @for (worker of workers(); track worker.id) {
                        <option [value]="worker.id">{{ worker.name }}</option>
                      }
                    </select>
                  </div>

                  <!-- Role selection -->
                  <div>
                    <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                    <select
                      id="role"
                      [ngModel]="newAssignment().role"
                      (ngModelChange)="updateRole($event)"
                      class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                    >
                      <option value="worker">Worker</option>
                      <option value="site_manager">Site Manager</option>
                    </select>
                  </div>

                  <!-- Start date -->
                  <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date *</label>
                    <input
                      type="date"
                      id="startDate"
                      [ngModel]="newAssignment().startDate"
                      (ngModelChange)="updateStartDate($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- End date -->
                  <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">End Date (Optional)</label>
                    <input
                      type="date"
                      id="endDate"
                      [ngModel]="newAssignment().endDate"
                      (ngModelChange)="updateEndDate($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="submitAddAssignment()"
              [disabled]="assignmentSuccess()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Add Assignment
            </button>
            <button
              type="button"
              (click)="closeAddAssignmentDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Remove Assignment Confirmation Dialog -->
  @if (showRemoveAssignmentDialog() && assignmentToRemove()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeRemoveAssignmentDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                  Remove Assignment
                </h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500">
                    Are you sure you want to remove <strong>{{ getWorkerById(assignmentToRemove()!.workerId)?.name }}</strong>
                    from this site? This action cannot be undone.
                  </p>
                </div>

                <!-- Error message -->
                @if (assignmentError()) {
                  <div class="mt-4 rounded-md bg-red-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-red-800">{{ assignmentError() }}</p>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="confirmRemoveAssignment()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Remove
            </button>
            <button
              type="button"
              (click)="closeRemoveAssignmentDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Add Material Dialog -->
  @if (showAddMaterialDialog()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeAddMaterialDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modal-title">
                  Add Material
                </h3>

                <!-- Success message -->
                @if (materialSuccess()) {
                  <div class="mb-4 rounded-md bg-green-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-green-800">{{ materialSuccess() }}</p>
                    </div>
                  </div>
                }

                <!-- Error message -->
                @if (materialError()) {
                  <div class="mb-4 rounded-md bg-red-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-red-800">{{ materialError() }}</p>
                    </div>
                  </div>
                }

                <!-- Form -->
                <div class="space-y-4">
                  <!-- Material selection -->
                  <div>
                    <label for="material" class="block text-sm font-medium text-gray-700 mb-1">Material *</label>
                    <select
                      id="material"
                      [ngModel]="newMaterial().materialId"
                      (ngModelChange)="updateMaterialId($event)"
                      class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                    >
                      <option value="">Select a material</option>
                      @for (material of materials(); track material.id) {
                        <option [value]="material.id" [disabled]="isMaterialAssigned(material.id)">
                          {{ material.name }} ({{ material.unit }}){{ isMaterialAssigned(material.id) ? ' - Already assigned' : '' }}
                        </option>
                      }
                    </select>
                  </div>

                  <!-- Planned quantity -->
                  <div>
                    <label for="plannedQty" class="block text-sm font-medium text-gray-700 mb-1">Planned Quantity (Optional)</label>
                    <input
                      type="number"
                      id="plannedQty"
                      [ngModel]="newMaterial().plannedQty"
                      (ngModelChange)="updatePlannedQty($event)"
                      step="0.01"
                      min="0"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                      placeholder="Enter planned quantity"
                    />
                  </div>

                  <!-- Actual quantity -->
                  <div>
                    <label for="actualQty" class="block text-sm font-medium text-gray-700 mb-1">Actual Quantity (Optional)</label>
                    <input
                      type="number"
                      id="actualQty"
                      [ngModel]="newMaterial().actualQty"
                      (ngModelChange)="updateActualQty($event)"
                      step="0.01"
                      min="0"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                      placeholder="Enter actual quantity"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="submitAddMaterial()"
              [disabled]="materialSuccess()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Add Material
            </button>
            <button
              type="button"
              (click)="closeAddMaterialDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Remove Material Confirmation Dialog -->
  @if (showRemoveMaterialDialog() && materialToRemove()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeRemoveMaterialDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                  Remove Material
                </h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500">
                    Are you sure you want to remove <strong>{{ getMaterialById(materialToRemove()!.materialId)?.name }}</strong>
                    from this site? This action cannot be undone.
                  </p>
                </div>

                <!-- Error message -->
                @if (materialError()) {
                  <div class="mt-4 rounded-md bg-red-50 p-4">
                    <div class="flex">
                      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                      </svg>
                      <p class="ml-3 text-sm font-medium text-red-800">{{ materialError() }}</p>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="confirmRemoveMaterial()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Remove
            </button>
            <button
              type="button"
              (click)="closeRemoveMaterialDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Add Daily Log Entry Dialog -->
  @if (showAddEntryDialog()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeAddEntryDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modal-title">
                  Add Entry
                </h3>

                <!-- Form -->
                <div class="space-y-4">
                  <!-- Worker selection -->
                  <div>
                    <label for="entryWorker" class="block text-sm font-medium text-gray-700 mb-1">Worker *</label>
                    <select
                      id="entryWorker"
                      [ngModel]="entryForm().workerId"
                      (ngModelChange)="updateEntryWorkerId($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    >
                      <option value="">Select a worker</option>
                      @for (worker of workers(); track worker.id) {
                        @if (isWorkerAssigned(worker.id)) {
                          <option [value]="worker.id">{{ worker.name }}</option>
                        }
                      }
                    </select>
                  </div>

                  <!-- Start time -->
                  <div>
                    <label for="entryStartTime" class="block text-sm font-medium text-gray-700 mb-1">Start Time *</label>
                    <input
                      type="time"
                      id="entryStartTime"
                      [ngModel]="entryForm().startTime"
                      (ngModelChange)="updateEntryStartTime($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- End time -->
                  <div>
                    <label for="entryEndTime" class="block text-sm font-medium text-gray-700 mb-1">End Time *</label>
                    <input
                      type="time"
                      id="entryEndTime"
                      [ngModel]="entryForm().endTime"
                      (ngModelChange)="updateEntryEndTime($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- Break minutes -->
                  <div>
                    <label for="entryBreakMinutes" class="block text-sm font-medium text-gray-700 mb-1">Break (minutes) *</label>
                    <input
                      type="number"
                      id="entryBreakMinutes"
                      [ngModel]="entryForm().breakMinutes"
                      (ngModelChange)="updateEntryBreakMinutes($event)"
                      min="0"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- Notes -->
                  <div>
                    <label for="entryNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea
                      id="entryNotes"
                      [ngModel]="entryForm().notes"
                      (ngModelChange)="updateEntryNotes($event)"
                      rows="3"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                      placeholder="Optional notes about the work performed"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="submitAddEntry()"
              [disabled]="dailyLogSuccess()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Add Entry
            </button>
            <button
              type="button"
              (click)="closeAddEntryDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Edit Daily Log Entry Dialog -->
  @if (showEditEntryDialog() && entryToEdit()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeEditEntryDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modal-title">
                  Edit Entry
                </h3>

                <!-- Form -->
                <div class="space-y-4">
                  <!-- Worker selection -->
                  <div>
                    <label for="editEntryWorker" class="block text-sm font-medium text-gray-700 mb-1">Worker *</label>
                    <select
                      id="editEntryWorker"
                      [ngModel]="entryForm().workerId"
                      (ngModelChange)="updateEntryWorkerId($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    >
                      <option value="">Select a worker</option>
                      @for (worker of workers(); track worker.id) {
                        @if (isWorkerAssigned(worker.id)) {
                          <option [value]="worker.id">{{ worker.name }}</option>
                        }
                      }
                    </select>
                  </div>

                  <!-- Start time -->
                  <div>
                    <label for="editEntryStartTime" class="block text-sm font-medium text-gray-700 mb-1">Start Time *</label>
                    <input
                      type="time"
                      id="editEntryStartTime"
                      [ngModel]="entryForm().startTime"
                      (ngModelChange)="updateEntryStartTime($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- End time -->
                  <div>
                    <label for="editEntryEndTime" class="block text-sm font-medium text-gray-700 mb-1">End Time *</label>
                    <input
                      type="time"
                      id="editEntryEndTime"
                      [ngModel]="entryForm().endTime"
                      (ngModelChange)="updateEntryEndTime($event)"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- Break minutes -->
                  <div>
                    <label for="editEntryBreakMinutes" class="block text-sm font-medium text-gray-700 mb-1">Break (minutes) *</label>
                    <input
                      type="number"
                      id="editEntryBreakMinutes"
                      [ngModel]="entryForm().breakMinutes"
                      (ngModelChange)="updateEntryBreakMinutes($event)"
                      min="0"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                    />
                  </div>

                  <!-- Notes -->
                  <div>
                    <label for="editEntryNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea
                      id="editEntryNotes"
                      [ngModel]="entryForm().notes"
                      (ngModelChange)="updateEntryNotes($event)"
                      rows="3"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                      placeholder="Optional notes about the work performed"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="submitEditEntry()"
              [disabled]="dailyLogSuccess()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Update Entry
            </button>
            <button
              type="button"
              (click)="closeEditEntryDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Delete Daily Log Entry Confirmation Dialog -->
  @if (showDeleteEntryDialog() && entryToDelete()) {
    <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-10 backdrop-blur-sm transition-opacity" (click)="closeDeleteEntryDialog()"></div>

        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-10">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                  Delete Entry
                </h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500">
                    Are you sure you want to delete this entry for <strong>{{ getWorkerById(entryToDelete()!.workerId)?.name || 'Unknown' }}</strong>?
                    This action cannot be undone.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              (click)="confirmDeleteEntry()"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Delete
            </button>
            <button
              type="button"
              (click)="closeDeleteEntryDialog()"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
